<!DOCTYPE html>
<html>
<head>
	<title>Main</title>
	<meta charset="utf-8">

	<style type="text/css">

		* {
			font-size: 12px;
		}

		#section_login {
			float: left;
			margin-bottom: 50px;
		}

		#section_products {
			clear: left;
		}

		table {
			float: left;
			clear: none;
			margin: 0 5px;
			padding: 5px 0;
			width: 150px;
		}

		.product {
			line-height: 1px;
			text-align: center;
		}

		#product_quantity {
			width: 50px;
		}

		#section_addItem {
			clear: left;
		}
		
		a {
			display: block;
			text-decoration: none;
		}

	</style>

</head>
<body onload='loadInfo();'>

<div id="section_login">

	<form>
		<table id = "areaLogin">
			<tr>
				<td colspan=2><button type = "button" id= "login" onclick="goLogin()">로그인</button></td>
			</tr>
		</table>
		<table id = "areaLogout" style="display:none;">
			<tr>
            <td><div id="loginInfo"></div></td>
        	</tr>
        	<tr>
        	<td><button type = "button" id= "logout" onclick="goLogout()">로그아웃</button></td>
        	</tr>
		</table>
		<!--<input type="text" id="login_ID" placeholder="ID">
		<br>
		<input type="password" id="login_PW" placeholder="********">-->
	</form>
</div>

<!--<button onclick="window.localStorage.clear();">스토리지 초기화 (새로고침하면 상품DB만 남아요)</button>-->
<p id="myPage"><a href="MyPage.html">마이 페이지</a></p>
<p id="toCart"><a href="cart.html">장바구니</a></p>

<div id="section_products">

	<div id="section_list" class="product list">
	</div>

	
	<script type="text/javascript">
		var localStorage = window.localStorage;
		
		var items_db = JSON.parse(localStorage.getItem("items"));
		var members_db = JSON.parse(localStorage.getItem("members"));  //로그인 용 회원 DB소환
		var cart = new Array(items_db.length);
		var cnt = -1; //로그인 db 참조 변수
		function loadInfo() {
			for (var i =0; i < items_db.length; i++)
				{
					var item = document.createElement("table");
					item.id = "item_"+i;
					document.getElementById("section_list").appendChild(item);

					var tr01 = document.createElement("tr");
					document.getElementById("item_"+i).appendChild(tr01);

					var td01 = document.createElement("td");
					td01.class = "product image";
					td01.setAttribute("colspan", "2");
					tr01.appendChild(td01);

					td01.innerHTML = '<img id="product_image" src = "' + items_db[i][3] +'" width="150px" height="150px">';

					var tr02 = document.createElement("tr");
					document.getElementById("item_"+i).appendChild(tr02);

					var td02 = document.createElement("td");
					td02.class = "product name";
					td02.setAttribute("colspan", "2");
					tr02.appendChild(td02);

					td02.innerHTML = '<p id="product_name">' + items_db[i][0] +'</p>';

					var tr03 = document.createElement("tr");
					document.getElementById("item_"+i).appendChild(tr03);

					var td03 = document.createElement("td");
					td03.class = "product price";
					td03.setAttribute("colspan", "2");
					tr03.appendChild(td03);

					td03.innerHTML = '<p id="product_price">' + items_db[i][1] +' 원</p>';

					var tr04 = document.createElement("tr");
					document.getElementById("item_"+i).appendChild(tr04);

					var td04 = document.createElement("td");
					td04.class = "product storage";
					td04.setAttribute("colspan", "2");
					tr04.appendChild(td04);

					td04.innerHTML = '<p id="product_image">' + items_db[i][2] +' set</p>';

					var tr05 = document.createElement("tr");
					document.getElementById("item_"+i).appendChild(tr05);

					var td05_1 = document.createElement("td");
					td05_1.innerHTML = '<input id="product_quantity'+i+'" type="number" step="1" min="1" max = "" value="1">';
					tr05.appendChild(td05_1);

					var td05_2 = document.createElement("td");
					td05_2.innerHTML = '<button onclick="add_cart('+i+')">장바구니 담기</button>';
					tr05.appendChild(td05_2);
                    
                    document.getElementById("product_quantity"+i).max = items_db[i][2];
				}
		}
        function add_cart(product_id){
            
            var product_quantity = parseInt(document.getElementById("product_quantity"+product_id).value);
            if(product_quantity>items_db[product_id][2]){
                window.alert("한도 수량을 초과하셨습니다.");
                return;
            }
            else{
            
            cart[product_id] = [];
            cart[product_id][0] = product_id;
            cart[product_id][1] = product_quantity;    
            localStorage.setItem("cart",JSON.stringify(cart));//확인용 스토리지 추후 삭제.
	    	members_db[0][6] = cart; // member[0] 에 저장
        	localStorage.setItem("members", JSON.stringify(members_db)); //members 갱신
            }
        }// localStorage 'cart'에 장바구니 품목, 수량 값 저장합니다.
        for(var i = 0; i<members_db.length; i++){
        	if(members_db[i][7]){
        		cnt=i;
        		document.getElementById("areaLogin").style.display = "none";
    			var Loginfo = document.getElementById("loginInfo");
        		Loginfo.innerHTML = members_db[i][2]+"님 환영합니다"; 
        		document.getElementById("areaLogout").style.display = "";
        		break;
        	}
        }
        function goLogin(){
        	window.location.replace("login.html"); //login 페이지로 이동
        }
       
        function goLogout(){
            document.getElementById("areaLogin").style.display = "";
            document.getElementById("areaLogout").style.display = "none";
            members_db[cnt][7]=false;
            localStorage.setItem("members", JSON.stringify(members_db));
            alert("로그아웃 되셨습니다");
            window.location.reload();
        }
        

	</script>

</div>

<!-- 관리자 모드에서 상품 추가 가능하므로 주석처리합니다 -제균
<div id="section_addItem">
	<a href="#"><button>상품 추가하기</button></a>
</div>
-->

</body>
</html>
